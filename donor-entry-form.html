<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PRC Baguio - Donor Entry</title>
<link rel="stylesheet" href="css/style.css">
<style>
body { font-family: Arial; margin:0; background:#fff; color:#b71c1c; }
header { background:#b71c1c; color:white; padding:10px 20px; display:flex; align-items:center; }
header img { height:50px; margin-right:15px; }
h1,h2 { margin:0; }
.container { padding:20px; max-width:1100px; margin:auto; }
form { display:grid; grid-template-columns: 200px 200px 200px 200px; grid-gap:10px; }
label { font-size:14px; align-self:center; }
input, select { padding:5px; font-size:14px; width:95%; }
input[type="submit"], button { padding:10px 20px; background:#b71c1c; color:white; border:none; cursor:pointer; }
input[type="submit"]:hover, button:hover { background:#a11212; }
.bottom-left { position:fixed; bottom:20px; left:20px; }
.bottom-right { position:fixed; bottom:20px; right:20px; }
</style>
</head>
<body>

<header>
<img src="assets/logo.png" alt="PRC Logo">
<div>
<h1>Philippine Red Cross</h1>
<h2>Baguio City Chapter - Donor Entry</h2>
</div>
</header>

<div class="container">
<form id="donorForm">

<!-- Donor Type -->
<label>Donor Type</label>
<input type="text" id="donorType" maxlength="1" placeholder="W/M/P">
<input type="text" id="conditionalBox" placeholder="If MBD/Patient Directed" style="display:none;">
<!-- Suffix before surname -->
<label>Suffix</label>
<input type="text" id="suffix" maxlength="3">
<label>Surname</label>
<input type="text" id="surname">
<label>First Name</label>
<input type="text" id="firstName">
<label>Middle Name</label>
<input type="text" id="middleName">

<!-- Birthday and Age -->
<label>Birth Month (MM)</label><input type="number" id="birthMonth" min="1" max="12">
<label>Birth Day (DD)</label><input type="number" id="birthDay" min="1" max="31">
<label>Birth Year (YYYY)</label><input type="number" id="birthYear" min="1900" max="2100">
<label>Age</label><input type="number" id="age" readonly>

<!-- Address -->
<label>Address</label><input type="text" id="address">
<label>City/Region</label><input type="text" id="city" maxlength="15">

<!-- Contact Number -->
<label>Contact Number</label>
<input type="text" id="contact1" maxlength="4" placeholder="XXXX">
<input type="text" id="contact2" maxlength="3" placeholder="XXX">
<input type="text" id="contact3" maxlength="4" placeholder="XXXX">

<!-- Serial Number -->
<label>Serial Number</label><input type="text" id="serial" readonly value="PRC2600-">

<!-- Blood Type -->
<label>Blood Type</label>
<input type="text" id="bloodType" maxlength="3">

<!-- Number of Times Donated -->
<label># Times Donated</label><input type="number" id="numDonations" min="1">

<!-- Blood Bag -->
<label>Blood Bag Used</label><input type="text" id="bloodBag" maxlength="1">
<label>Blood Bag Type</label><input type="text" id="bagType" maxlength="1">
<label>Amount Collected</label><input type="text" id="amountCollected" maxlength="1">

<!-- Time Started / Ended -->
<label>Time Started (HH)</label><input type="number" id="timeStartH" min="1" max="12">
<label>Time Started (MM)</label><input type="number" id="timeStartM" min="1" max="60">
<label>Time Ended (HH)</label><input type="number" id="timeEndH" min="1" max="12">
<label>Time Ended (MM)</label><input type="number" id="timeEndM" min="1" max="60">

<input type="submit" value="Submit" class="bottom-right">
</form>
</div>

<button class="bottom-left" onclick="window.location.href='donor-entry.html'">Back to Dashboard</button>

<script>
// Auto-fill donor type
const donorTypeInput = document.getElementById("donorType");
const conditionalBox = document.getElementById("conditionalBox");

donorTypeInput.addEventListener("input", ()=>{
    const val = donorTypeInput.value.toUpperCase();
    if(val=="W"){ donorTypeInput.value="Walk-in"; conditionalBox.style.display="none"; }
    else if(val=="M"){ donorTypeInput.value="MBD"; conditionalBox.style.display="inline-block"; }
    else if(val=="P"){ donorTypeInput.value="Patient Directed"; conditionalBox.style.display="inline-block"; }
});

// Auto calculate age
function calculateAge(){
    const mm = parseInt(document.getElementById("birthMonth").value);
    const dd = parseInt(document.getElementById("birthDay").value);
    let yy = parseInt(document.getElementById("birthYear").value);
    if(yy<100) yy += (yy>30)?1900:2000; // handle 2-digit years
    const today = new Date();
    let age = today.getFullYear() - yy;
    if(today.getMonth()+1 < mm || (today.getMonth()+1==mm && today.getDate()<dd)) age--;
    document.getElementById("age").value=age;
}

document.getElementById("birthMonth").addEventListener("input", calculateAge);
document.getElementById("birthDay").addEventListener("input", calculateAge);
document.getElementById("birthYear").addEventListener("input", calculateAge);

// Blood Type auto-fill with colors
const bloodTypeInput = document.getElementById("bloodType");
bloodTypeInput.addEventListener("input", ()=>{
    const val = bloodTypeInput.value.toUpperCase();
    let color="";
    if(val=="AP") { bloodTypeInput.value="A+"; color="blue"; }
    else if(val=="AN") { bloodTypeInput.value="A-"; color="blue"; }
    else if(val=="BP") { bloodTypeInput.value="B+"; color="yellow"; }
    else if(val=="BN") { bloodTypeInput.value="B-"; color="yellow"; }
    else if(val=="ABP") { bloodTypeInput.value="AB+"; color="pink"; }
    else if(val=="ABN") { bloodTypeInput.value="AB-"; color="pink"; }
    else if(val=="OP") { bloodTypeInput.value="O+"; color="white"; }
    else if(val=="ON") { bloodTypeInput.value="O-"; color="white"; }
    bloodTypeInput.style.background=color;
});

// Blood Bag auto-fill
const bloodBag = document.getElementById("bloodBag");
bloodBag.addEventListener("input", ()=>{
    const val = bloodBag.value.toUpperCase();
    if(val=="K") bloodBag.value="Karmi";
    else if(val=="T") bloodBag.value="Terumo";
});

// Blood Bag Type auto-fill
const bagType = document.getElementById("bagType");
bagType.addEventListener("input", ()=>{
    const val = bagType.value.toUpperCase();
    if(val=="S") bagType.value="Single";
    else if(val=="D") bagType.value="Double";
    else if(val=="T") bagType.value="Triple";
    else if(val=="Q") bagType.value="Quadruple";
});

// Amount Collected auto-fill
const amountCollected = document.getElementById("amountCollected");
amountCollected.addEventListener("input", ()=>{
    const val = amountCollected.value.toUpperCase();
    if(val=="4") amountCollected.value="450ml";
    else if(val=="Q") amountCollected.value="QNS";
    else if(val=="U") amountCollected.value="UB";
});

// Auto-cursor move for contact number
const contact1 = document.getElementById("contact1");
const contact2 = document.getElementById("contact2");
const contact3 = document.getElementById("contact3");
contact1.addEventListener("input", ()=>{ if(contact1.value.length>=4) contact2.focus(); });
contact2.addEventListener("input", ()=>{ if(contact2.value.length>=3) contact3.focus(); });

// Submit data
document.getElementById("donorForm").addEventListener("submit", function(e){
    e.preventDefault();
    // Gather all data
    const donor={
        donorType:donorTypeInput.value,
        conditional:conditionalBox.value,
        suffix:document.getElementById("suffix").value,
        surname:document.getElementById("surname").value,
        firstName:document.getElementById("firstName").value,
        middleName:document.getElementById("middleName").value,
        birthMonth:document.getElementById("birthMonth").value,
        birthDay:document.getElementById("birthDay").value,
        birthYear:document.getElementById("birthYear").value,
        age:document.getElementById("age").value,
        address:document.getElementById("address").value,
        city:document.getElementById("city").value,
        contact1:contact1.value,
        contact2:contact2.value,
        contact3:contact3.value,
        serial:document.getElementById("serial").value,
        bloodType:document.getElementById("bloodType").value,
        numDonations:document.getElementById("numDonations").value,
        bloodBag:bloodBag.value,
        bagType:bagType.value,
        amountCollected:amountCollected.value,
        timeStartH:document.getElementById("timeStartH").value,
        timeStartM:document.getElementById("timeStartM").value,
        timeEndH:document.getElementById("timeEndH").value,
        timeEndM:document.getElementById("timeEndM").value
    };
    // Save to localStorage
    let donors = JSON.parse(localStorage.getItem("donors")||"[]");
    donors.push(donor);
    localStorage.setItem("donors",JSON.stringify(donors));
    alert("Donor added!");
    this.reset();
    conditionalBox.style.display="none";
});
</script>
</body>
</html>
