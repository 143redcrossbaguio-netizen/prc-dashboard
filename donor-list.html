<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Donor List</title>
<link rel="stylesheet" href="css/style.css">
<style>
body { font-family: Arial; background:#fff; color:#b71c1c; margin:0; }
header { background:#b71c1c; color:white; padding:10px 20px; display:flex; align-items:center;}
header img { height:50px; margin-right:15px; }
table { width:100%; border-collapse:collapse; margin-top:20px;}
table, th, td { border:1px solid #b71c1c; }
th, td { padding:8px; text-align:left; }
input { padding:5px; margin:5px 0; }
.bottom-right { position:fixed; bottom:20px; right:20px; }
</style>
</head>
<body>

<header>
    <img src="assets/logo.png" alt="PRC Logo">
    <div>
        <h1>Philippine Red Cross</h1>
        <h2>Baguio City Chapter - Donor List</h2>
    </div>
</header>

<div style="padding:20px;">
<input type="text" id="searchInput" placeholder="Search donor..." onkeyup="filterTable()">
<button onclick="printTable()">Print Table</button>
<button onclick="exportTable()">Export Excel</button>

<table id="donorTable">
<thead>
<tr>
<th>Date</th><th>Type</th><th>Suffix</th><th>Surname</th><th>First</th><th>Middle</th>
<th>Age</th><th>Address</th><th>City</th><th>Contact</th><th>Serial</th>
<th>Blood Type</th><th># Donations</th><th>Bag</th><th>Bag Type</th><th>Amount</th><th>Start</th><th>End</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

<button class="bottom-right" onclick="window.location.href='donor-entry.html'">Back to Dashboard</button>

<script>
// Load donor data from localStorage
function loadDonors(){
    const donors = JSON.parse(localStorage.getItem("donors")||"[]");
    const tbody = document.querySelector("#donorTable tbody");
    tbody.innerHTML="";
    donors.forEach(d=>{
        const tr=document.createElement("tr");
        for(let key in d) { const td=document.createElement("td"); td.innerText=d[key]; tr.appendChild(td); }
        tbody.appendChild(tr);
    });
}
loadDonors();

// Filter
function filterTable(){
    const val=document.getElementById("searchInput").value.toLowerCase();
    document.querySelectorAll("#donorTable tbody tr").forEach(row=>{
        row.style.display=Array.from(row.cells).some(cell=>cell.innerText.toLowerCase().includes(val))?"":"none";
    });
}

// Print
function printTable(){
    const table = document.getElementById("donorTable").outerHTML;
    const win = window.open("");
    win.document.write("<html><head><title>Donor List</title></head><body>"+table+"</body></html>");
    win.print();
    win.close();
}

// Export Excel (simple CSV method)
function exportTable(){
    const rows = document.querySelectorAll("#donorTable tr");
    let csv="";
    rows.forEach(r=>{
        const cells = r.querySelectorAll("th, td");
        csv+=Array.from(cells).map(c=>`"${c.innerText}"`).join(",")+"\n";
    });
    const blob = new Blob([csv], {type:"text/csv"});
    const a=document.createElement("a");
    a.href=URL.createObjectURL(blob);
    a.download="donor_list.csv";
    a.click();
}
</script>

</body>
</html>
