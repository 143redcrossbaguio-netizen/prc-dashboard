<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Donor List | PRC Baguio</title>
<style>
body { font-family:"Segoe UI", Arial, sans-serif; background:#f7f7f7; margin:0; color:#333;}
header { display:flex; align-items:center; gap:15px; padding:15px 30px; border-bottom:4px solid #c62828; background:#fff;}
header img { height:55px; }
header h2 { color:#c62828; margin:0; font-weight:700; }
.container { max-width:1400px; margin:25px auto; padding:20px; }
.filters { display:flex; gap:12px; flex-wrap:wrap; margin-bottom:15px; align-items:center; justify-content:space-between; }
.filters-left { display:flex; gap:12px; flex-wrap:wrap; }
.filters button { margin-left:5px; }
table { width:100%; border-collapse:collapse; background:#fff; }
th, td { border:1px solid #ccc; padding:8px; text-align:center; font-size:14px; }
th { background:#c62828; color:white; font-weight:600; }
tr:nth-child(even) { background:#f2f2f2; }
button { cursor:pointer; border:none; border-radius:4px; padding:5px 10px; font-size:14px; }
.edit-btn { background:#0288d1; color:white; }
.delete-btn { background:#d32f2f; color:white; }
.center, .bottom-buttons { display:flex; gap:10px; margin-top:12px; justify-content:center; }
.color-A { background:#f28b82; }
.color-B { background:#fbbc04; }
.color-AB { background:#34a853; color:white; }
.color-O { background:#4285f4; color:white; }
.noPrint { display:inline-block; }
@media print {
  .noPrint { display:none; }
  table { width:100%; border:1px solid #000; }
  th, td { border:1px solid #000; font-size:12px; }
}
</style>
</head>
<body>

<header>
  <img src="assets/logo.png" alt="PRC Logo">
  <h2>Philippine Red Cross ‚Äì Baguio City Chapter</h2>
</header>

<div class="container">

<!-- FILTERS + ACTIONS -->
<div class="filters">
  <div class="filters-left">
    <input type="text" id="searchInput" placeholder="Search All Data">
    <input type="date" id="filterDate">
    <select id="filterSex">
      <option value="">All Sex</option>
      <option value="M">Male</option>
      <option value="F">Female</option>
    </select>
    <select id="filterBlood">
      <option value="">All Blood Types</option>
      <option value="A+">A+</option>
      <option value="A-">A-</option>
      <option value="B+">B+</option>
      <option value="B-">B-</option>
      <option value="AB+">AB+</option>
      <option value="AB-">AB-</option>
      <option value="O+">O+</option>
      <option value="O-">O-</option>
    </select>
    <select id="filterDonorType">
      <option value="">All Donor Types</option>
      <option value="Walk-in">Walk-in</option>
      <option value="MBD">MBD</option>
      <option value="Patient Directed">Patient Directed</option>
    </select>
  </div>

  <!-- Action buttons -->
  <div>
    <button class="noPrint" onclick="exportExcel()">Export to Excel</button>
    <button class="noPrint" onclick="exportGoogleSheet()">Export to Google Sheet</button>
    <button class="noPrint" onclick="window.print()">Print</button>
  </div>
</div>

<!-- TABLE -->
<table id="donorTable">
  <thead>
    <tr>
      <th>#</th>
      <th>Date</th>
      <th>Donor Type</th>
      <th>Extra</th>
      <th>Suffix</th>
      <th>Surname</th>
      <th>First</th>
      <th>Middle</th>
      <th>Birthday</th>
      <th>Age</th>
      <th>Sex</th>
      <th>Address</th>
      <th>City</th>
      <th>Contact</th>
      <th>Serial</th>
      <th>Blood Type</th>
      <th>Times Donated</th>
      <th>Bag Used</th>
      <th>Bag Type</th>
      <th>Amount</th>
      <th>Time</th>
      <th class="noPrint">Edit</th>
      <th class="noPrint">Delete</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<!-- BOTTOM NAVIGATION -->
<div class="bottom-buttons noPrint">
  <button onclick="location.href='dashboard.html'">Back to Homepage</button>
  <button onclick="location.href='donor-entry.html'">Add New Donor</button>
</div>

</div>

<script>
// Load Donors
let donors = JSON.parse(localStorage.getItem('donors')||'[]');

function renderTable() {
  const tbody = document.querySelector("#donorTable tbody");
  tbody.innerHTML = "";
  const search = document.getElementById('searchInput').value.toLowerCase();
  const fDate = document.getElementById('filterDate').value;
  const fSex = document.getElementById('filterSex').value;
  const fBlood = document.getElementById('filterBlood').value;
  const fDonor = document.getElementById('filterDonorType').value;

  let count = 1;
  donors.forEach((d,i)=>{
    if(fDate && d.date!==fDate) return;
    if(fSex && d.sex!==fSex) return;
    if(fBlood && d.bloodType!==fBlood) return;
    if(fDonor && d.donorType!==fDonor) return;

    let vals = Object.values(d).join(' ').toLowerCase();
    if(search && !vals.includes(search)) return;

    let bloodClass='';
    if(d.bloodType.includes('A')) bloodClass='color-A';
    else if(d.bloodType.includes('B') && !d.bloodType.includes('AB')) bloodClass='color-B';
    else if(d.bloodType.includes('AB')) bloodClass='color-AB';
    else if(d.bloodType.includes('O')) bloodClass='color-O';

    tbody.innerHTML += `<tr>
      <td>${count++}</td>
      <td>${d.date}</td>
      <td>${d.donorType}</td>
      <td>${d.donorExtra}</td>
      <td>${d.suffix}</td>
      <td>${d.surname}</td>
      <td>${d.firstName}</td>
      <td>${d.middleName}</td>
      <td>${d.birthday}</td>
      <td>${d.age}</td>
      <td>${d.sex}</td>
      <td>${d.address}</td>
      <td>${d.city}</td>
      <td>${d.contact}</td>
      <td>${d.serial}</td>
      <td class="${bloodClass}">${d.bloodType}</td>
      <td>${d.times}</td>
      <td>${d.bagUsed==="Karmi"?"K":d.bagUsed==="Terumo"?"T":d.bagUsed}</td>
      <td>${d.bagType[0]}</td>
      <td>${d.amount}</td>
      <td>${d.time}</td>
      <td class="noPrint"><button class="edit-btn" onclick="editDonor(${i})">‚úèÔ∏è</button></td>
      <td class="noPrint"><button class="delete-btn" onclick="deleteDonor(${i})">üóëÔ∏è</button></td>
    </tr>`;
  });
}

function editDonor(index){
  localStorage.setItem('editIndex', index);
  location.href='donor-entry.html';
}

function deleteDonor(index){
  if(confirm("Are you sure you want to delete this donor?")){
    donors.splice(index,1);
    localStorage.setItem('donors', JSON.stringify(donors));
    renderTable();
  }
}

document.getElementById('searchInput').oninput = renderTable;
document.getElementById('filterDate').onchange = renderTable;
document.getElementById('filterSex').onchange = renderTable;
document.getElementById('filterBlood').onchange = renderTable;
document.getElementById('filterDonorType').onchange = renderTable;

function exportExcel(){
  let csvContent = "data:text/csv;charset=utf-8,";
  const headers = Array.from(document.querySelectorAll("#donorTable th"))
    .filter(th=>!th.classList.contains("noPrint"))
    .map(th=>th.textContent).join(",");
  csvContent += headers + "\r\n";
  donors.forEach(d=>{
    csvContent += [
      d.date,d.donorType,d.donorExtra,d.suffix,d.surname,d.firstName,d.middleName,
      d.birthday,d.age,d.sex,d.address,d.city,d.contact,d.serial,d.bloodType,d.times,
      d.bagUsed==="Karmi"?"K":d.bagUsed==="Terumo"?"T":d.bagUsed,
      d.bagType[0],d.amount,d.time
    ].join(",")+"\r\n";
  });
  const encodedUri = encodeURI(csvContent);
  const link = document.createElement("a");
  link.setAttribute("href", encodedUri);
  link.setAttribute("download", "donor_list.csv");
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

function exportGoogleSheet(){
  alert("Google Sheet export requires API integration. CSV can be uploaded manually for now.");
}

// Initial render
renderTable();
</script>

</body>
</html>
