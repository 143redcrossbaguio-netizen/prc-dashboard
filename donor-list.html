<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Donor List | PRC Baguio</title>
<style>
body {
  font-family: "Segoe UI", Arial, sans-serif;
  background: #f9f9f9;
  margin: 0;
  color: #333;
}

header {
  display: flex;
  align-items: center;
  gap: 15px;
  padding: 15px 30px;
  border-bottom: 4px solid #c62828;
}

header img {
  height: 55px;
}

header h2 {
  color: #c62828;
  margin: 0;
  font-weight: 700;
}

/* Container */
.container {
  max-width: 1200px;
  margin: 20px auto;
  padding: 20px;
}

/* Buttons */
button {
  padding: 8px 14px;
  border: none;
  border-radius: 5px;
  font-weight: 600;
  cursor: pointer;
}

button:hover { opacity: 0.9; }

.primary { background: #c62828; color: #fff; }
.secondary { background: #eee; color: #333; }

button.icon-btn { font-size: 16px; padding: 4px 8px; }

/* Table */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
}

table, th, td { border: 1px solid #ccc; }
th, td { padding: 6px; text-align: left; font-size: 12px; }

th { background: #c62828; color: #fff; }

.blood-A { background: #a0c4ff; }
.blood-B { background: #ffe066; }
.blood-AB { background: #ffadad; }
.blood-O { background: #fff; }

.action-col { text-align: center; }

@media print {
  button, .action-col, .filters { display: none; }
  @page { size: A4 landscape; margin: 10mm; }
  body { font-size: 11px; }
}
</style>
</head>
<body>

<header>
  <img src="assets/logo.png">
  <h2>Philippine Red Cross â€“ Baguio City Chapter</h2>
</header>

<div class="container">
  <div class="controls">
    <button class="primary" onclick="window.print()">Print Donor List</button>
    <button class="primary" onclick="exportToCSV()">Export to CSV</button>
    <button class="secondary" onclick="location.href='dashboard.html'">Back to Homepage</button>
  </div>

  <div class="filters">
    <label>Filter by Blood Type:
      <select id="filterBlood" onchange="renderTable()">
        <option value="">All</option>
        <option value="A+">A+</option>
        <option value="A-">A-</option>
        <option value="B+">B+</option>
        <option value="B-">B-</option>
        <option value="AB+">AB+</option>
        <option value="AB-">AB-</option>
        <option value="O+">O+</option>
        <option value="O-">O-</option>
      </select>
    </label>
    <label>Search:
      <input type="text" id="searchAll" oninput="renderTable()" placeholder="Search all data">
    </label>
  </div>

  <table id="donorTable">
    <thead>
      <tr>
        <th>#</th>
        <th>Date</th>
        <th>Donor Type</th>
        <th>Suffix</th>
        <th>Surname</th>
        <th>First Name</th>
        <th>Middle Name</th>
        <th>Birthday</th>
        <th>Age</th>
        <th>Contact</th>
        <th>Address</th>
        <th>City</th>
        <th>Serial</th>
        <th>Blood Type</th>
        <th>Times Donated</th>
        <th>Bag Used</th>
        <th>Bag Type</th>
        <th>Amount</th>
        <th>Time Started</th>
        <th>Time Ended</th>
        <th class="action-col">Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
// Load donors from localStorage
let donors = JSON.parse(localStorage.getItem('donors') || '[]');

// Filters
function renderTable() {
  const tbody = document.querySelector('#donorTable tbody');
  tbody.innerHTML = '';
  const bloodFilter = document.getElementById('filterBlood').value.toUpperCase();
  const search = document.getElementById('searchAll').value.toLowerCase();
  
  let count = 0;
  donors.forEach((d,i)=>{
    // Blood type filter
    if(bloodFilter && d.bloodType.toUpperCase() !== bloodFilter) return;
    // Search all fields
    const values = Object.values(d).join(" ").toLowerCase();
    if(search && !values.includes(search)) return;

    count++;
    // Abbreviate Bag Used / Bag Type / Amount for printing
    const bagUsed = d.bagUsed.toLowerCase()==="karmi"?"K":d.bagUsed.toLowerCase()==="terumo"?"T":d.bagUsed;
    const bagType = d.bagType.toLowerCase()==="single"?"S":d.bagType.toLowerCase()==="double"?"D":d.bagType.toLowerCase()==="triple"?"T":d.bagType;
    const amount = d.amount.toLowerCase()==="450ml"?"4":d.amount.toUpperCase();

    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${count}</td>
      <td>${d.date}</td>
      <td>${d.donorType}</td>
      <td>${d.suffix}</td>
      <td>${d.surname}</td>
      <td>${d.firstName}</td>
      <td>${d.middleName}</td>
      <td>${d.birthday}</td>
      <td>${d.age}</td>
      <td>${d.contact}</td>
      <td>${d.address}</td>
      <td>${d.city}</td>
      <td>${d.serial}</td>
      <td class="blood-${d.bloodType[0]}">${d.bloodType}</td>
      <td>${d.times}</td>
      <td>${bagUsed}</td>
      <td>${bagType}</td>
      <td>${amount}</td>
      <td>${d.timeStart}</td>
      <td>${d.timeEnd}</td>
      <td class="action-col">
        <button class="icon-btn" onclick="editDonor(${i})">ðŸ–‰</button>
        <button class="icon-btn" onclick="deleteDonor(${i})">ðŸ—‘</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

// Edit donor
function editDonor(index) {
  localStorage.setItem('editIndex', index);
  location.href='donor-entry.html';
}

// Delete donor
function deleteDonor(index) {
  if(confirm("Are you sure to delete this donor?")) {
    donors.splice(index,1);
    localStorage.setItem('donors', JSON.stringify(donors));
    renderTable();
  }
}

// Export to CSV (for Google Sheets)
function exportToCSV() {
  let csv = "data:text/csv;charset=utf-8,";
  csv += ["No","Date","Donor Type","Suffix","Surname","First Name","Middle Name","Birthday","Age","Contact","Address","City","Serial","Blood Type","Times Donated","Bag Used","Bag Type","Amount","Time Started","Time Ended"].join(",") + "\n";
  donors.forEach((d,i)=>{
    const bagUsed = d.bagUsed.toLowerCase()==="karmi"?"K":d.bagUsed.toLowerCase()==="terumo"?"T":d.bagUsed;
    const bagType = d.bagType.toLowerCase()==="single"?"S":d.bagType.toLowerCase()==="double"?"D":d.bagType.toLowerCase()==="triple"?"T":d.bagType;
    const amount = d.amount.toLowerCase()==="450ml"?"4":d.amount.toUpperCase();
    csv += [i+1,d.date,d.donorType,d.suffix,d.surname,d.firstName,d.middleName,d.birthday,d.age,d.contact,d.address,d.city,d.serial,d.bloodType,d.times,bagUsed,bagType,amount,d.timeStart,d.timeEnd].join(",") + "\n";
  });
  const link = document.createElement("a");
  link.setAttribute("href", encodeURI(csv));
  link.setAttribute("download","donor_list.csv");
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

renderTable();
</script>

</body>
</html>
