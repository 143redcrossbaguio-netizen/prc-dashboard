<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Donor List | PRC Baguio</title>
<style>
body { font-family:"Segoe UI",Arial,sans-serif; background:#fff; margin:0; color:#333;}
header {display:flex; align-items:center; gap:15px; padding:15px 30px; border-bottom:4px solid #c62828;}
header img {height:55px;}
header h2 {color:#c62828; margin:0; font-weight:700;}
.container {max-width:1400px; margin:25px auto; padding:20px;}
.row {display:flex; gap:10px; align-items:center; margin-bottom:10px; flex-wrap:wrap;}
label {font-weight:600; color:#444; min-width:120px;}
input, select {border:1px solid #ccc; padding:7px 9px; border-radius:5px; font-size:14px;}
input:focus, select:focus {outline:none; border-color:#c62828;}
table {width:100%; border-collapse:collapse; margin-top:15px;}
th, td {border:1px solid #ccc; padding:7px; text-align:center;}
th {background:#c62828; color:#fff;}
tr:nth-child(even) {background:#f9f9f9;}
button {background:#c62828; color:white; border:none; padding:5px 10px; border-radius:4px; cursor:pointer;}
button:hover {background:#a91f1f;}
.secondary {background:#eee; color:#333;}
.secondary:hover {background:#ddd;}
.actions button {margin:0 2px; padding:3px 6px;}
.blood-A+ {background:#ffebee;}
.blood-A- {background:#ffcdd2;}
.blood-B+ {background:#f3e5f5;}
.blood-B- {background:#e1bee7;}
.blood-AB+ {background:#e3f2fd;}
.blood-AB- {background:#bbdefb;}
.blood-O+ {background:#e8f5e9;}
.blood-O- {background:#c8e6c9;}
@media print {
  body {margin:0.5in;}
  button, #filters, .actions {display:none;}
  table {page-break-inside:auto;}
  tr {page-break-inside:avoid; page-break-after:auto;}
}
</style>
</head>

<body>

<header>
  <img src="assets/logo.png">
  <h2>Philippine Red Cross ‚Äì Baguio City Chapter</h2>
</header>

<div class="container">

<div class="row" id="filters">
  <button class="secondary" onclick="location.href='dashboard.html'">Back to Homepage</button>

  <input type="text" id="searchBox" placeholder="Search all data..." class="auto">

  <select id="filterSex">
    <option value="">All Sex</option>
    <option value="M">Male</option>
    <option value="F">Female</option>
  </select>

  <select id="filterType">
    <option value="">All Donor Types</option>
    <option value="Walk-in">Walk-in</option>
    <option value="MBD">MBD</option>
    <option value="Patient Directed">Patient Directed</option>
  </select>

  <select id="filterBlood">
    <option value="">All Blood Types</option>
    <option value="A+">A+</option>
    <option value="A-">A-</option>
    <option value="B+">B+</option>
    <option value="B-">B-</option>
    <option value="AB+">AB+</option>
    <option value="AB-">AB-</option>
    <option value="O+">O+</option>
    <option value="O-">O-</option>
  </select>

  <input type="date" id="filterDate">

  <button onclick="exportGoogleSheet()">Export to Google Sheet</button>
  <button onclick="window.print()">Print List</button>
</div>

<table id="donorTable">
  <thead>
    <tr>
      <th>#</th>
      <th>Date</th>
      <th>Donor Type</th>
      <th>Name</th>
      <th>Birthday</th>
      <th>Age</th>
      <th>Sex</th>
      <th>Address</th>
      <th>City/Region</th>
      <th>Contact</th>
      <th>Serial</th>
      <th>Blood Type</th>
      <th>Times Donated</th>
      <th>Bag Used</th>
      <th>Bag Type</th>
      <th>Amount</th>
      <th>Time</th>
      <th class="actions">Actions</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>

</div>

<script>
// LOAD DATA
function loadDonors(){
  const donors = JSON.parse(localStorage.getItem("donors") || "[]");
  const tbody = document.querySelector("#donorTable tbody");
  tbody.innerHTML="";
  let count=1;

  donors.forEach((d,i)=>{
    const tr = document.createElement("tr");
    tr.innerHTML=`
      <td>${count++}</td>
      <td>${d.date}</td>
      <td>${d.donorType}</td>
      <td>${d.suffix} ${d.surname}, ${d.firstName} ${d.middleName}</td>
      <td>${d.birthday}</td>
      <td>${d.age}</td>
      <td>${d.sex}</td>
      <td>${d.address}</td>
      <td>${d.city}</td>
      <td>${d.contact}</td>
      <td>${d.serial}</td>
      <td class="blood-${d.bloodType.replace("+","p").replace("-","n")}">${d.bloodType}</td>
      <td>${d.times}</td>
      <td>${d.bagUsed=="Karmi"?"K":d.bagUsed=="Terumo"?"T":d.bagUsed}</td>
      <td>${d.bagType=="Single"?"S":d.bagType=="Double"?"D":d.bagType=="Triple"?"T":d.bagType}</td>
      <td>${d.amount}</td>
      <td>${d.time}</td>
      <td class="actions">
        <button onclick="editDonor(${i})">‚úèÔ∏è</button>
        <button onclick="deleteDonor(${i})">üóëÔ∏è</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

function editDonor(index){
  const donors = JSON.parse(localStorage.getItem("donors") || "[]");
  localStorage.setItem("editDonor", JSON.stringify(donors[index]));
  localStorage.setItem("editIndex", index);
  location.href="donor-entry.html";
}

function deleteDonor(index){
  if(confirm("Delete this donor?")){
    const donors = JSON.parse(localStorage.getItem("donors") || "[]");
    donors.splice(index,1);
    localStorage.setItem("donors", JSON.stringify(donors));
    loadDonors();
  }
}

// FILTERS
document.getElementById("searchBox").oninput=applyFilters;
document.getElementById("filterSex").onchange=applyFilters;
document.getElementById("filterType").onchange=applyFilters;
document.getElementById("filterBlood").onchange=applyFilters;
document.getElementById("filterDate").onchange=applyFilters;

function applyFilters(){
  const search = document.getElementById("searchBox").value.toLowerCase();
  const sexF = document.getElementById("filterSex").value;
  const typeF = document.getElementById("filterType").value;
  const bloodF = document.getElementById("filterBlood").value;
  const dateF = document.getElementById("filterDate").value;

  const donors = JSON.parse(localStorage.getItem("donors") || "[]");
  const tbody = document.querySelector("#donorTable tbody");
  tbody.innerHTML="";
  let count=1;

  donors.forEach((d,i)=>{
    if(sexF && d.sex!==sexF) return;
    if(typeF && d.donorType!==typeF) return;
    if(bloodF && d.bloodType!==bloodF) return;
    if(dateF && d.date!==dateF) return;

    if(search){
      const vals = Object.values(d).join(" ").toLowerCase();
      if(!vals.includes(search)) return;
    }

    const tr = document.createElement("tr");
    tr.innerHTML=`
      <td>${count++}</td>
      <td>${d.date}</td>
      <td>${d.donorType}</td>
      <td>${d.suffix} ${d.surname}, ${d.firstName} ${d.middleName}</td>
      <td>${d.birthday}</td>
      <td>${d.age}</td>
      <td>${d.sex}</td>
      <td>${d.address}</td>
      <td>${d.city}</td>
      <td>${d.contact}</td>
      <td>${d.serial}</td>
      <td class="blood-${d.bloodType.replace("+","p").replace("-","n")}">${d.bloodType}</td>
      <td>${d.times}</td>
      <td>${d.bagUsed=="Karmi"?"K":d.bagUsed=="Terumo"?"T":d.bagUsed}</td>
      <td>${d.bagType=="Single"?"S":d.bagType=="Double"?"D":d.bagType=="Triple"?"T":d.bagType}</td>
      <td>${d.amount}</td>
      <td>${d.time}</td>
      <td class="actions">
        <button onclick="editDonor(${i})">‚úèÔ∏è</button>
        <button onclick="deleteDonor(${i})">üóëÔ∏è</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

// EXPORT TO GOOGLE SHEET
function exportGoogleSheet(){
  alert("This will open Google Sheets export (requires server integration or Apps Script).");
}

loadDonors();
</script>

</body>
</html>
