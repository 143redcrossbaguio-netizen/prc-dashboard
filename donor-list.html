<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Donor List | PRC Baguio</title>

<style>
body {
  font-family: "Segoe UI", Arial, sans-serif;
  background: #f8f8f8;
  margin: 0;
  color: #333;
}

header {
  display: flex;
  align-items: center;
  gap: 15px;
  padding: 15px 30px;
  border-bottom: 4px solid #c62828;
  background: #ffffff;
}

header img {
  height: 55px;
}

header h2 {
  color: #c62828;
  margin: 0;
  font-weight: 700;
}

.container {
  max-width: 1400px;
  margin: 25px auto;
  padding: 20px;
}

/* FILTERS */
.filters {
  display: flex;
  gap: 12px;
  margin-bottom: 20px;
  flex-wrap: wrap;
}

.filters input, .filters select {
  padding: 7px 10px;
  border-radius: 5px;
  border: 1px solid #ccc;
  min-width: 120px;
}

/* TABLE */
table {
  width: 100%;
  border-collapse: collapse;
  background: #fff;
}

table th, table td {
  border: 1px solid #ccc;
  padding: 8px 10px;
  text-align: center;
  font-size: 14px;
}

table th {
  background: #c62828;
  color: white;
  font-weight: 700;
}

/* COLOR CODE BLOOD TYPES */
.blood-A+ { background: #ff9999; }
.blood-A- { background: #ffb3b3; }
.blood-B+ { background: #ffcc99; }
.blood-B- { background: #ffd9b3; }
.blood-AB+ { background: #99ccff; }
.blood-AB- { background: #b3d9ff; }
.blood-O+ { background: #99ff99; }
.blood-O- { background: #b3ffb3; }

/* BUTTONS */
button {
  background: #c62828;
  color: white;
  border: none;
  padding: 8px 14px;
  border-radius: 5px;
  font-weight: 600;
  cursor: pointer;
}

button:hover { background: #a91f1f; }

.secondary { background: #eeeeee; color: #333; }
.secondary:hover { background: #dddddd; }

/* ICON BUTTONS */
button.edit { background: #4caf50; }
button.delete { background: #f44336; }

/* HIDE BUTTONS ON PRINT */
@media print {
  button, .filters, .skip-serial { display: none; }
  table { page-break-after: always; }
}
</style>
</head>

<body>

<header>
  <img src="assets/logo.png" alt="PRC Logo">
  <h2>Philippine Red Cross â€“ Baguio City Chapter</h2>
</header>

<div class="container">

<div class="filters">
  <input type="text" id="search" placeholder="Search any field...">
  <input type="date" id="filterDate">
  <select id="filterSex">
    <option value="">All Sex</option>
    <option value="M">Male</option>
    <option value="F">Female</option>
  </select>
  <select id="filterBlood">
    <option value="">All Blood Types</option>
    <option value="A+">A+</option>
    <option value="A-">A-</option>
    <option value="B+">B+</option>
    <option value="B-">B-</option>
    <option value="AB+">AB+</option>
    <option value="AB-">AB-</option>
    <option value="O+">O+</option>
    <option value="O-">O-</option>
  </select>
  <select id="filterDonor">
    <option value="">All Donor Types</option>
    <option value="Walk-in">Walk-in</option>
    <option value="MBD">MBD</option>
    <option value="Patient Directed">Patient Directed</option>
  </select>
  <button onclick="exportToExcel()">Export to Excel</button>
</div>

<div class="skip-serial">
  <button onclick="showSkippedSerials()">Skipped Serial Numbers</button>
</div>

<table id="donorTable">
  <thead>
    <tr>
      <th>#</th>
      <th>Date</th>
      <th>Donor Type</th>
      <th>Suffix</th>
      <th>Surname</th>
      <th>First Name</th>
      <th>Middle Name</th>
      <th>Birthday</th>
      <th>Age</th>
      <th>Sex</th>
      <th>Address</th>
      <th>City</th>
      <th>Contact</th>
      <th>Serial</th>
      <th>Blood Type</th>
      <th>Times Donated</th>
      <th>Bag Used</th>
      <th>Bag Type</th>
      <th>Amount</th>
      <th>Time</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <!-- DATA WILL BE APPENDED HERE -->
  </tbody>
</table>

</div>

<script>
let donors = [];

// EXAMPLE: function to add donor (in real usage, push from donor entry)
function addDonor(donor){
  donors.push(donor);
  renderTable();
}

function renderTable(){
  const tbody = document.querySelector('#donorTable tbody');
  tbody.innerHTML = '';
  donors.forEach((d,i)=>{
    const tr = document.createElement('tr');
    const serialClass = d.bloodType.replace(/\+/g,'p').replace(/-/g,'n'); // CSS class safe
    tr.innerHTML=`
      <td>${i+1}</td>
      <td>${d.date}</td>
      <td>${d.donorType}</td>
      <td>${d.suffix}</td>
      <td>${d.surname}</td>
      <td>${d.firstName}</td>
      <td>${d.middleName}</td>
      <td>${d.birthday}</td>
      <td>${d.age}</td>
      <td>${d.sex}</td>
      <td>${d.address}</td>
      <td>${d.city}</td>
      <td>${d.contact}</td>
      <td>${d.serial}</td>
      <td class="blood-${d.bloodType.replace(/\+/g,'p').replace(/-/g,'n')}">${d.bloodType}</td>
      <td>${d.times}</td>
      <td>${d.bagUsed.startsWith('Karmi')?'K':d.bagUsed.startsWith('Terumo')?'T':d.bagUsed}</td>
      <td>${d.bagType[0]}</td>
      <td>${d.amount}</td>
      <td>${d.time}</td>
      <td>
        <button class="edit" onclick="editDonor(${i})">âœŽ</button>
        <button class="delete" onclick="deleteDonor(${i})">ðŸ—‘</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

/* DELETE */
function deleteDonor(index){
  if(confirm("Are you sure to delete this donor?")){
    donors.splice(index,1);
    renderTable();
  }
}

/* EDIT */
function editDonor(index){
  const d = donors[index];
  // Here you can redirect to donor entry page with prefilled data
  alert("Edit donor: "+d.firstName+" "+d.surname);
}

/* SEARCH & FILTER */
document.getElementById('search').oninput = applyFilters;
document.getElementById('filterDate').onchange = applyFilters;
document.getElementById('filterSex').onchange = applyFilters;
document.getElementById('filterBlood').onchange = applyFilters;
document.getElementById('filterDonor').onchange = applyFilters;

function applyFilters(){
  const search = document.getElementById('search').value.toLowerCase();
  const fDate = document.getElementById('filterDate').value;
  const fSex = document.getElementById('filterSex').value;
  const fBlood = document.getElementById('filterBlood').value;
  const fDonor = document.getElementById('filterDonor').value;

  const filtered = donors.filter(d=>{
    const values = Object.values(d).join(' ').toLowerCase();
    return (!search || values.includes(search)) &&
           (!fDate || d.date===fDate) &&
           (!fSex || d.sex===fSex) &&
           (!fBlood || d.bloodType===fBlood) &&
           (!fDonor || d.donorType===fDonor);
  });

  const tbody = document.querySelector('#donorTable tbody');
  tbody.innerHTML = '';
  filtered.forEach((d,i)=>{
    const tr = document.createElement('tr');
    tr.innerHTML=`
      <td>${i+1}</td>
      <td>${d.date}</td>
      <td>${d.donorType}</td>
      <td>${d.suffix}</td>
      <td>${d.surname}</td>
      <td>${d.firstName}</td>
      <td>${d.middleName}</td>
      <td>${d.birthday}</td>
      <td>${d.age}</td>
      <td>${d.sex}</td>
      <td>${d.address}</td>
      <td>${d.city}</td>
      <td>${d.contact}</td>
      <td>${d.serial}</td>
      <td class="blood-${d.bloodType.replace(/\+/g,'p').replace(/-/g,'n')}">${d.bloodType}</td>
      <td>${d.times}</td>
      <td>${d.bagUsed.startsWith('Karmi')?'K':d.bagUsed.startsWith('Terumo')?'T':d.bagUsed}</td>
      <td>${d.bagType[0]}</td>
      <td>${d.amount}</td>
      <td>${d.time}</td>
      <td>
        <button class="edit" onclick="editDonor(${i})">âœŽ</button>
        <button class="delete" onclick="deleteDonor(${i})">ðŸ—‘</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

/* EXPORT TO EXCEL */
function exportToExcel(){
  let csv = '';
  const headers = Array.from(document.querySelectorAll('#donorTable thead th'))
    .filter((th)=>th.innerText!=='Actions')
    .map(th=>`"${th.innerText}"`).join(',');
  csv += headers + '\n';

  donors.forEach(d=>{
    const row = [
      d.date,d.donorType,d.suffix,d.surname,d.firstName,d.middleName,d.birthday,d.age,d.sex,d.address,d.city,
      d.contact,d.serial,d.bloodType,d.times,
      d.bagUsed.startsWith('Karmi')?'K':d.bagUsed.startsWith('Terumo')?'T':d.bagUsed,
      d.bagType[0],d.amount,d.time
    ];
    csv += row.map(v=>`"${v}"`).join(',')+'\n';
  });

  const blob = new Blob([csv], {type: 'text/csv'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'donor_list.csv';
  a.click();
  URL.revokeObjectURL(url);
}

/* SKIPPED SERIALS */
function showSkippedSerials(){
  const skipped = donors.filter(d=>!d.serial).map(d=>d.firstName+' '+d.surname);
  if(skipped.length===0) alert("No skipped serial numbers.");
  else alert("Skipped Serial Numbers:\n"+skipped.join('\n'));
}

/* SAMPLE DATA */
addDonor({
  date: "2026-02-08",
  donorType:"Walk-in",
  suffix:"",
  surname:"Reyes",
  firstName:"Juan",
  middleName:"Dela",
  birthday:"08-02-1996",
  age:30,
  sex:"M",
  address:"123 Street",
  city:"Baguio",
  contact:"09171234567",
  serial:"001",
  bloodType:"A+",
  times:"2",
  bagUsed:"Karmi",
  bagType:"Single",
  amount:"450mL",
  time:"09:00-09:30"
});

</script>
</body>
</html>
