<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PRC Donor Database</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #f2f2f2;
}

header {
  background: #c62828;
  color: white;
  padding: 15px;
  display: flex;
  align-items: center;
}

header img {
  height: 45px;
  margin-right: 15px;
}

.main {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 15px;
  padding: 15px;
}

.panel {
  background: white;
  padding: 15px;
  border-radius: 6px;
  border: 2px solid #c62828;
}

h3 {
  color: #c62828;
  margin-top: 0;
}

label {
  font-weight: bold;
  margin-top: 6px;
  display: block;
}

input {
  padding: 6px;
  margin-top: 3px;
  width: 100%;
  box-sizing: border-box;
}

.small { width: 80px; }
.city { width: 150px; }
.contact { width: 70px; }

.row {
  display: flex;
  gap: 6px;
  align-items: center;
}

.hidden { display: none; }

button {
  padding: 10px;
  border: none;
  cursor: pointer;
}

.submit {
  background: #c62828;
  color: white;
  width: 100%;
  margin-top: 10px;
}

.export, .print {
  background: #555;
  color: white;
  margin-right: 5px;
}

table {
  width: 100%;
  border-collapse: collapse;
  font-size: 12px;
}

th, td {
  border: 1px solid #ccc;
  padding: 5px;
}

th {
  background: #c62828;
  color: white;
}

@media print {
  button { display: none; }
  body { background: white; }
}
</style>
</head>

<body>

<header>
  <img src="assets/logo.png">
  <h2>Philippine Red Cross â€“ Baguio City Chapter</h2>
</header>

<div class="main">

<!-- ================= LEFT PANEL ================= -->
<div class="panel">
<h3>Donor Data Entry</h3>

<label>Date</label>
<input type="date" id="date">

<label>Donor Type (W / M / P)</label>
<input id="donorType" onkeyup="setDonorType()">

<input id="extraBox" class="hidden" placeholder="MBD / Patient Info">

<div class="row">
  <div style="flex:1">
    <label>Surname</label>
    <input id="surname">
  </div>
  <div>
    <label>Suffix</label>
    <input id="suffix" maxlength="3" class="small">
  </div>
</div>

<label>First Name</label>
<input id="fname">

<label>Middle Name</label>
<input id="mname">

<label>Birthdate</label>
<div class="row">
  <input id="mm" placeholder="MM" maxlength="2" class="small" onkeyup="calcAge()">
  <input id="dd" placeholder="DD" maxlength="2" class="small" onkeyup="calcAge()">
  <input id="yy" placeholder="YY/YYYY" maxlength="4" class="small" onkeyup="calcAge()">
</div>

<label>Age</label>
<input id="age" readonly>

<label>Address</label>
<input id="address">

<label>City / Region</label>
<input id="city" maxlength="15" class="city">

<label>Contact Number</label>
<div class="row">
  <input maxlength="4" class="contact">
  <input maxlength="3" class="contact">
  <input maxlength="4" class="contact">
</div>

<label>Blood Bag Used (K / T)</label>
<input id="bagUsed" onkeyup="fillBagUsed()">

<label>Blood Bag Type (S / D / T)</label>
<input id="bagType" onkeyup="fillBagType()">

<label>Amount Collected (4 / Q / U)</label>
<input id="amount" onkeyup="fillAmount()">

<label>Time Started</label>
<div class="row">
  <input placeholder="HH" maxlength="2" class="small">
  <input placeholder="MM" maxlength="2" class="small">
</div>

<label>Time Ended</label>
<div class="row">
  <input placeholder="HH" maxlength="2" class="small">
  <input placeholder="MM" maxlength="2" class="small">
</div>

<button class="submit" onclick="saveDonor()">SUBMIT</button>
</div>

<!-- ================= RIGHT PANEL ================= -->
<div class="panel">
<h3>Donor List</h3>

<button class="export" onclick="exportCSV()">EXPORT EXCEL</button>
<button class="print" onclick="window.print()">PRINT</button>

<table id="table">
<thead>
<tr>
<th>Date</th><th>Type</th><th>Name</th><th>Age</th><th>City</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

</div>

<script>
document.getElementById("date").valueAsDate = new Date();
let donors = JSON.parse(localStorage.getItem("donors")) || [];

function setDonorType(){
  let v = donorType.value.toUpperCase();
  if(v === "W") donorType.value = "WALK-IN";
  if(v === "M"){ donorType.value = "MBD"; extraBox.classList.remove("hidden"); }
  if(v === "P"){ donorType.value = "PATIENT DIRECTED"; extraBox.classList.remove("hidden"); }
}

function calcAge(){
  let y = yy.value;
  if(y.length === 2) y = "19" + y;
  if(y.length === 4){
    age.value = new Date().getFullYear() - parseInt(y);
  }
}

function fillBagUsed(){
  if(bagUsed.value.toUpperCase() === "K") bagUsed.value = "KARMI";
  if(bagUsed.value.toUpperCase() === "T") bagUsed.value = "TERUMO";
}

function fillBagType(){
  let v = bagType.value.toUpperCase();
  if(v === "S") bagType.value = "SINGLE";
  if(v === "D") bagType.value = "DOUBLE";
  if(v === "T") bagType.value = "TRIPLE";
}

function fillAmount(){
  let v = amount.value.toUpperCase();
  if(v === "4") amount.value = "450mL";
  if(v === "Q") amount.value = "QNS";
  if(v === "U") amount.value = "UB";
}

function saveDonor(){
  donors.push({
    date: date.value,
    type: donorType.value,
    name: surname.value + ", " + fname.value,
    age: age.value,
    city: city.value
  });
  localStorage.setItem("donors", JSON.stringify(donors));
  render();
}

function render(){
  let tbody = document.querySelector("#table tbody");
  tbody.innerHTML = "";
  donors.forEach(d=>{
    tbody.innerHTML += `<tr>
      <td>${d.date}</td>
      <td>${d.type}</td>
      <td>${d.name}</td>
      <td>${d.age}</td>
      <td>${d.city}</td>
    </tr>`;
  });
}
render();

function exportCSV(){
  let csv = "Date,Type,Name,Age,City\n";
  donors.forEach(d=>{
    csv += `${d.date},${d.type},${d.name},${d.age},${d.city}\n`;
  });
  let a = document.createElement("a");
  a.href = "data:text/csv;charset=utf-8," + encodeURIComponent(csv);
  a.download = "donors.csv";
  a.click();
}
</script>

</body>
</html>
