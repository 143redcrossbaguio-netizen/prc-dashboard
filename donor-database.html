<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PRC Baguio - Donor List</title>
<style>
body { font-family: Arial; background:#fff; color:#b71c1c; margin:0;}
header { background:#b71c1c; color:white; padding:10px 20px; display:flex; align-items:center;}
header img { height:50px; margin-right:15px; }
h1,h2 { margin:5px 0; }
.container { padding:20px; }
input[type="text"] { padding:5px; width:100%; margin-bottom:10px; font-size:14px;}
button { padding:10px 20px; background:#b71c1c; color:white; border:none; cursor:pointer; font-size:14px; margin-bottom:10px;}
table { width:100%; border-collapse: collapse; }
table, th, td { border:1px solid #b71c1c; }
th, td { padding:5px; font-size:13px; text-align:left;}
.bloodA {background-color:lightblue;}
.bloodB {background-color:lightyellow;}
.bloodAB {background-color:lightpink;}
.bloodO {background-color:white;}
.month {background:#f5f5f5; font-weight:bold;}
</style>
</head>
<body>

<header>
    <img src="https://upload.wikimedia.org/wikipedia/commons/f/f5/Philippine_Red_Cross_logo.svg" alt="PRC Logo">
    <div>
        <h1>Philippine Red Cross</h1>
        <h2>Baguio City Chapter - Donor List</h2>
    </div>
</header>

<div class="container">
    <a href="donor-entry.html"><button>Go to Donor Entry</button></a>
    <input type="text" id="searchDonor" placeholder="Search donor list...">
    <button id="exportBtn">Export as Excel</button>
    <table>
        <thead>
            <tr>
                <th>Date</th><th>Donor Type</th><th>Name</th><th>Suffix</th><th>Age</th>
                <th>Address</th><th>City</th><th>Contact</th><th>Serial</th><th>Blood Type</th>
                <th># Donations</th><th>Bag Used</th><th>Bag Type</th><th>Amount</th>
                <th>Start Time</th><th>End Time</th>
            </tr>
        </thead>
        <tbody id="donorTable"></tbody>
    </table>
</div>

<script>
// Load donors
let donors = JSON.parse(localStorage.getItem("donors")||"[]");

// Render table
function renderList(list=donors){
    let tbody = document.getElementById("donorTable");
    tbody.innerHTML="";
    let grouped={};
    list.forEach(d=>{grouped[d.date.slice(0,7)]=grouped[d.date.slice(0,7)]||[]; grouped[d.date.slice(0,7)].push(d);});
    for(let m in grouped){
        tbody.innerHTML+=`<tr class="month"><td colspan="16">${m}</td></tr>`;
        grouped[m].forEach(d=>{
            let bloodClass="";
            if(d.bloodType.startsWith("A")) bloodClass="bloodA";
            else if(d.bloodType.startsWith("B")&&!d.bloodType.startsWith("AB")) bloodClass="bloodB";
            else if(d.bloodType.startsWith("AB")) bloodClass="bloodAB";
            else if(d.bloodType.startsWith("O")) bloodClass="bloodO";

            tbody.innerHTML+=`<tr>
                <td>${d.date}</td>
                <td>${d.donorType}${d.extra?" - "+d.extra:""}</td>
                <td>${d.surname}, ${d.fname} ${d.mname}</td>
                <td>${d.suffix}</td>
                <td>${d.age}</td>
                <td>${d.address}</td>
                <td>${d.city}</td>
                <td>${d.contact}</td>
                <td>${d.serial}</td>
                <td class="${bloodClass}">${d.bloodType}</td>
                <td>${d.numDonations}</td>
                <td>${d.bagUsed}</td>
                <td>${d.bagType}</td>
                <td>${d.amount}</td>
                <td>${d.startTime}</td>
                <td>${d.endTime}</td>
            </tr>`;
        });
    }
}
renderList();

// Live search
document.getElementById("searchDonor").addEventListener("input", function(){
    let keyword = this.value.toLowerCase();
    if(!keyword) return renderList();
    let filtered = donors.filter(d=> Object.values(d).some(v=>String(v).toLowerCase().includes(keyword)));
    renderList(filtered);
});

// Export Excel
document.getElementById("exportBtn").addEventListener("click", function(){
    let table = document.getElementById("donorTable");
    let html = table.outerHTML.replace(/ /g, '%20');
    let link = document.createElement("a");
    link.href = 'data:application/vnd.ms-excel,' + html;
    link.download = 'donor_list.xls';
    link.click();
});
</script>

</body>
</html>
