<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PRC Donor Database</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { margin:0; font-family:Arial, sans-serif; background:#f2f2f2; }
header { background:#c62828; color:white; padding:15px; display:flex; align-items:center; }
header img { height:45px; margin-right:15px; }
.dashboard { display:flex; gap:15px; padding:15px; }
.card { flex:1; background:white; border:2px solid #c62828; padding:25px; text-align:center; font-weight:bold; color:#c62828; cursor:pointer; }
.section { display:none; padding:20px; background:white; margin:15px; border:2px solid #c62828; }
.section.active { display:block; }
label { font-weight:bold; display:block; margin-top:8px; }
input, select { width:100%; padding:6px; margin-top:3px; box-sizing:border-box; }
.row { display:flex; gap:6px; }
.small { width:80px; }
.city { width:150px; }
.contact { width:70px; }
button { margin-top:15px; padding:12px; border:none; background:#c62828; color:white; width:100%; cursor:pointer; }
table { width:100%; border-collapse:collapse; margin-top:15px; font-size:12px; }
th, td { border:1px solid #ccc; padding:5px; text-align:center; }
th { background:#c62828; color:white; }
.month { background:#eee; font-weight:bold; }
.bloodA { background:#ADD8E6; } /* Blue */
.bloodB { background:#FFFF99; } /* Yellow */
.bloodAB { background:#FFC0CB; } /* Pink */
.bloodO { background:#FFFFFF; } /* White */
.hidden { display:none; }
@media print {
  header, .dashboard, .section:not(#listSection), button, #searchInput { display:none; }
  #listSection { display:block; border:none; }
  @page { size: landscape; }
}
</style>
</head>
<body>

<header>
  <img src="assets/logo.png">
  <h2>Philippine Red Cross â€“ Baguio City Chapter</h2>
</header>

<div class="dashboard">
  <div class="card" onclick="showSection('entrySection')">DONOR ENTRY</div>
  <div class="card" onclick="showSection('listSection')">DONOR LIST</div>
</div>

<!-- ================= DONOR ENTRY ================= -->
<div id="entrySection" class="section active">
<h3>Donor Entry</h3>

<label>Date</label>
<input type="date" id="date">

<label>Donor Type (W/M/P)</label>
<input id="donorType" onkeyup="setDonorType()">
<input id="extraBox" class="hidden" placeholder="MBD / Patient Info">

<div class="row">
  <div style="flex:1">
    <label>Surname</label>
    <input id="surname">
  </div>
  <div>
    <label>Suffix</label>
    <input id="suffix" maxlength="3" class="small">
  </div>
</div>

<label>First Name</label>
<input id="fname">
<label>Middle Name</label>
<input id="mname">

<label>Birthdate</label>
<div class="row">
  <input id="mm" placeholder="MM" maxlength="2" class="small" onkeyup="calcAge()">
  <input id="dd" placeholder="DD" maxlength="2" class="small" onkeyup="calcAge()">
  <input id="yy" placeholder="YY/YYYY" maxlength="4" class="small" onkeyup="calcAge()">
</div>

<label>Age</label>
<input id="age" readonly>

<label>Address</label>
<input id="address">

<label>City / Region</label>
<input id="city" maxlength="15" class="city">

<label>Contact Number</label>
<div class="row">
  <input maxlength="4" class="contact" id="contact1">
  <input maxlength="3" class="contact" id="contact2">
  <input maxlength="4" class="contact" id="contact3">
</div>

<label>Serial Number</label>
<div class="row">
  <input value="PRC2600-" readonly style="width:100px">
  <input id="serialNumber">
</div>

<label>Blood Type</label>
<input id="bloodType" onkeyup="fillBloodType()" placeholder="AP/AN/BP/BN/ABP/ABN/OP/ON">

<label>Number of Times Donated</label>
<input id="numDonations" type="number" min="1" onkeyup="nextOnEnter(event,'bagUsed')">

<label>Blood Bag Used (K/T)</label>
<input id="bagUsed" onkeyup="fillBagUsed();nextOnEnter(event,'bagType')">

<label>Blood Bag Type (S/D/T/Q)</label>
<input id="bagType" onkeyup="fillBagType();nextOnEnter(event,'amount')">

<label>Amount Collected (4/Q/U)</label>
<input id="amount" onkeyup="fillAmount();nextOnEnter(event,'startHH')">

<label>Time Started</label>
<div class="row">
  <input placeholder="HH" maxlength="2" class="small" id="startHH" onkeyup="nextOnEnter(event,'startMM')">
  <input placeholder="MM" maxlength="2" class="small" id="startMM" onkeyup="nextOnEnter(event,'endHH')">
</div>

<label>Time Ended</label>
<div class="row">
  <input placeholder="HH" maxlength="2" class="small" id="endHH" onkeyup="nextOnEnter(event,'endMM')">
  <input placeholder="MM" maxlength="2" class="small" id="endMM">
</div>

<button onclick="saveDonor()">SUBMIT</button>
</div>

<!-- ================= DONOR LIST ================= -->
<div id="listSection" class="section">
<h3>Donor List (Compiled Monthly)</h3>

<input type="text" id="searchInput" placeholder="Search..." onkeyup="searchDonor()" style="margin-bottom:10px; padding:6px; width:30%;">

<button onclick="window.print()">PRINT DONOR LIST</button>

<table>
<thead>
<tr>
<th>Date</th>
<th>Type</th>
<th>Name</th>
<th>Suffix</th>
<th>Age</th>
<th>Address</th>
<th>City</th>
<th>Contact</th>
<th>Serial</th>
<th>Blood Type</th>
<th>Times Donated</th>
<th>Bag Used</th>
<th>Bag Type</th>
<th>Amount</th>
<th>Start</th>
<th>End</th>
</tr>
</thead>
<tbody id="donorTable"></tbody>
</table>
</div>

<script>
document.getElementById("date").valueAsDate = new Date();
let donors = JSON.parse(localStorage.getItem("donors")) || [];

function showSection(id){
  document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

function setDonorType(){
  let v = donorType.value.toUpperCase();
  if(v === "W") donorType.value = "WALK-IN";
  if(v === "M"){ donorType.value = "MBD"; extraBox.classList.remove("hidden"); }
  if(v === "P"){ donorType.value = "PATIENT DIRECTED"; extraBox.classList.remove("hidden"); }
}

function calcAge(){
  let y = yy.value;
  if(y.length === 2) y = "19"+y;
  if(y.length === 4){
    age.value = new Date().getFullYear() - parseInt(y);
  }
}

function fillBagUsed(){
  let v = bagUsed.value.toUpperCase();
  if(v==="K") bagUsed.value="KARMI";
  if(v==="T") bagUsed.value="TERUMO";
}

function fillBagType(){
  let v = bagType.value.toUpperCase();
  if(v==="S") bagType.value="SINGLE";
  if(v==="D") bagType.value="DOUBLE";
  if(v==="T") bagType.value="TRIPLE";
  if(v==="Q") bagType.value="QUADRUPLE";
}

function fillAmount(){
  let v = amount.value.toUpperCase();
  if(v==="4") amount.value="450mL";
  if(v==="Q") amount.value="QNS";
  if(v==="U") amount.value="UB";
}

function fillBloodType(){
  let v = bloodType.value.toUpperCase();
  let mapping = {AP:"A+",AN:"A-",BP:"B+",BN:"B-",ABP:"AB+",ABN:"AB-",OP:"O+",ON:"O-"};
  if(mapping[v]) bloodType.value = mapping[v];
}

function nextOnEnter(e, nextId){
  if(e.key === "Enter" || e.key === "Tab" || e.target.value.length === e.target.maxLength){
    e.preventDefault();
    document.getElementById(nextId).focus();
  }
}

function saveDonor(){
  let existing = donors.find(d => d.surname===surname.value && d.fname===fname.value && d.mname===mname.value);
  let donations = parseInt(numDonations.value) || 1;
  if(existing) donations = existing.numDonations + 1;

  donors.push({
    date: date.value,
    month: new Date(date.value).toLocaleString("default",{month:"long",year:"numeric"}),
    donorType: donorType.value,
    extra: extraBox.value,
    surname: surname.value,
    suffix: suffix.value,
    fname: fname.value,
    mname: mname.value,
    age: age.value,
    address: address.value,
    city: city.value,
    contact: contact1.value+"-"+contact2.value+"-"+contact3.value,
    serial: "PRC2600-"+serialNumber.value,
    bloodType: bloodType.value,
    numDonations: donations,
    bagUsed: bagUsed.value,
    bagType: bagType.value,
    amount: amount.value,
    startTime: startHH.value+":"+startMM.value,
    endTime: endHH.value+":"+endMM.value
  });

  localStorage.setItem("donors", JSON.stringify(donors));
  document.getElementById("entrySection").querySelectorAll("input").forEach(i=>i.value="");
  document.getElementById("date").valueAsDate = new Date();
  renderList();
}

function renderList(){
  let tbody = document.getElementById("donorTable");
  tbody.innerHTML="";
  let grouped = {};
  donors.forEach(d=>{
    grouped[d.month] = grouped[d.month]||[];
    grouped[d.month].push(d);
  });
  for(let m in grouped){
    tbody.innerHTML+=`<tr class="month"><td colspan="16">${m}</td></tr>`;
    grouped[m].forEach(d=>{
      let bloodClass="";
      if(d.bloodType.startsWith("A")) bloodClass="bloodA";
      else if(d.bloodType.startsWith("B") && !d.bloodType.startsWith("AB")) bloodClass="bloodB";
      else if(d.bloodType.startsWith("AB")) bloodClass="bloodAB";
      else if(d.bloodType.startsWith("O")) bloodClass="bloodO";
      tbody.innerHTML+=`<tr>
        <td>${d.date}</td>
        <td>${d.donorType}${d.extra?(" - "+d.extra):""}</td>
        <td>${d.surname}, ${d.fname} ${d.mname}</td>
        <td>${d.suffix}</td>
        <td>${d.age}</td>
        <td>${d.address}</td>
        <td>${d.city}</td>
        <td>${d.contact}</td>
        <td>${d.serial}</td>
        <td class="${bloodClass}">${d.bloodType}</td>
        <td>${d.numDonations}</td>
        <td>${d.bagUsed}</td>
        <td>${d.bagType}</td>
        <td>${d.amount}</td>
        <td>${d.startTime}</td>
        <td>${d.endTime}</td>
      </tr>`;
    });
  }
}

function searchDonor(){
  let input=document.getElementById("searchInput").value.toLowerCase();
  let rows=document.querySelectorAll("#donorTable tr:not(.month)");
  rows.forEach(r=>{
    r.style.display=Array.from(r.cells).some(c=>c.textContent.toLowerCase().includes(input))?"":"none";
  });
}

renderList();
</script>

</body>
</html>
