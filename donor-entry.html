<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Donor Entry | PRC Baguio</title>
<style>
:root {
  --prc-red: #c62828;
  --gray-900: #263238;
  --gray-700: #546e7a;
  --gray-400: #b0bec5;
  --gray-100: #f7f9fb;
  --input-bg: #fff;
}
body { font-family:"Segoe UI", Arial,sans-serif; background:var(--gray-100); margin:0; color:var(--gray-900);}
header { display:flex; align-items:center; gap:15px; padding:15px 30px; border-bottom:4px solid var(--prc-red); background:var(--gray-100);}
header img { height:55px; }
header h2 { color:var(--prc-red); margin:0; font-weight:700; font-size:20px; }
.container { max-width:1200px; margin:25px auto; padding:20px; background:var(--input-bg); border-radius:8px; box-shadow:0 3px 8px rgba(0,0,0,0.1); }
.section { margin-bottom:18px; }
.section-title { font-weight:700; color:var(--prc-red); margin-bottom:10px; }
.row { display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-bottom:10px; }
input { border:1px solid var(--gray-400); border-radius:5px; padding:7px 9px; font-size:14px; }
input:focus { outline:none; border-color:var(--prc-red);}
.auto { flex:1; min-width:140px; }
.small { width:110px; }
.mini { width:70px; }
.serial-prefix { background:var(--gray-200); padding:6px 10px; border-radius:5px; font-weight:bold; }
.buttons { display:flex; justify-content:space-between; align-items:center; margin-top:20px; flex-wrap:wrap; gap:10px; }
.center-btns { display:flex; gap:12px; }
button { background:var(--prc-red); color:white; border:none; padding:10px 18px; border-radius:6px; font-weight:600; cursor:pointer; }
button:hover { background:#a91f1f; }
button.secondary { background:var(--gray-200); color:var(--gray-900); }
button.secondary:hover { background:var(--gray-300); }
#donorExtra { display:none; }
</style>
</head>
<body>

<header>
  <img src="assets/logo.png" alt="PRC Logo">
  <h2>Philippine Red Cross â€“ Baguio City Chapter</h2>
</header>

<div class="container">
<form id="donorForm">

<!-- BASIC -->
<div class="section">
  <div class="section-title">Basic Information</div>
  <div class="row">
    <label>Date</label>
    <input type="date" id="entryDate">
  </div>
  <div class="row">
    <label>Donor Type</label>
    <input id="donorType" class="small" maxlength="1">
    <input id="donorExtra" class="auto" placeholder="Specify if required">
  </div>
</div>

<!-- NAME -->
<div class="section">
  <div class="section-title">Donor Name</div>
  <div class="row">
    <input id="suffix" placeholder="Suffix" class="mini">
    <input id="surname" placeholder="Surname" class="auto">
    <input id="firstName" placeholder="First Name" class="auto">
    <input id="middleName" placeholder="Middle Name" class="auto">
  </div>
</div>

<!-- BIRTH -->
<div class="section">
  <div class="section-title">Birth Information</div>
  <div class="row">
    <input id="bd" class="mini" maxlength="2" placeholder="DD">
    <input id="bm" class="mini" maxlength="2" placeholder="MM">
    <input id="by" class="mini" maxlength="4" placeholder="YY/YYYY">
    <label>Age</label>
    <input id="age" class="small" readonly>
  </div>
</div>

<!-- CONTACT -->
<div class="section">
  <div class="section-title">Contact Details</div>
  <div class="row">
    <input id="address" class="auto" placeholder="Address">
    <input id="city" class="small" maxlength="15" placeholder="City / Region">
  </div>
  <div class="row">
    <label>Contact</label>
    <input id="c1" class="mini" maxlength="4">
    <input id="c2" class="mini" maxlength="3">
    <input id="c3" class="mini" maxlength="4">
  </div>
</div>

<!-- BLOOD -->
<div class="section">
  <div class="section-title">Blood & Collection</div>
  <div class="row">
    <label>Serial</label>
    <span class="serial-prefix">PRC2600-</span>
    <input id="serial" class="auto">
  </div>
  <div class="row">
    <label>Blood Type</label>
    <input id="bloodType" class="small">
    <label>Times Donated</label>
    <input id="times" class="mini">
  </div>
  <div class="row">
    <label>Bag Used</label>
    <input id="bagUsed" class="small">
    <label>Bag Type</label>
    <input id="bagType" class="small">
    <label>Amount</label>
    <input id="amount" class="small">
  </div>
  <div class="row">
    <label>Time</label>
    <input id="sh" class="mini" maxlength="2">
    <input id="sm" class="mini" maxlength="2">
    <span>to</span>
    <input id="eh" class="mini" maxlength="2">
    <input id="em" class="mini" maxlength="2">
  </div>
</div>

<!-- BUTTONS -->
<div class="buttons">
  <button type="button" class="secondary" onclick="location.href='dashboard.html'">Back to Homepage</button>
  <div class="center-btns">
    <button type="button" onclick="saveDonor()">Submit</button>
    <button type="button" class="secondary" onclick="location.href='donor-list.html'">Go to Donor List</button>
  </div>
</div>

</form>
</div>

<script>
const today = new Date().toISOString().split("T")[0];
document.getElementById('entryDate').value = today;

// Local storage
let donors = JSON.parse(localStorage.getItem('donors') || '[]');
let skippedSerials = JSON.parse(localStorage.getItem('skippedSerials') || '[]');

// EDIT MODE
let editIndex = localStorage.getItem('editIndex');
if(editIndex!==null){
  const d = donors[editIndex];
  document.getElementById('entryDate').value=d.date;
  document.getElementById('donorType').value=d.type.charAt(0).toUpperCase();
  if(d.type!=="Walk-in") {document.getElementById('donorExtra').style.display="inline-block"; document.getElementById('donorExtra').value=d.type;}
  document.getElementById('suffix').value=d.suffix;
  document.getElementById('surname').value=d.surname;
  document.getElementById('firstName').value=d.firstName;
  document.getElementById('middleName').value=d.middleName;
  document.getElementById('bd').value=d.birthday.split('-')[0];
  document.getElementById('bm').value=d.birthday.split('-')[1];
  document.getElementById('by').value=d.birthday.split('-')[2];
  document.getElementById('age').value=d.age;
  document.getElementById('address').value=d.address;
  document.getElementById('city').value=d.city;
  document.getElementById('c1').value=d.contact.split('-')[0];
  document.getElementById('c2').value=d.contact.split('-')[1];
  document.getElementById('c3').value=d.contact.split('-')[2];
  document.getElementById('serial').value=d.serial;
  document.getElementById('bloodType').value=d.bloodType;
  document.getElementById('times').value=d.times;
  document.getElementById('bagUsed').value=d.bagUsed;
  document.getElementById('bagType').value=d.bagType;
  document.getElementById('amount').value=d.amount;
  document.getElementById('sh').value=d.timeStart.split(':')[0];
  document.getElementById('sm').value=d.timeStart.split(':')[1];
  document.getElementById('eh').value=d.timeEnd.split(':')[0];
  document.getElementById('em').value=d.timeEnd.split(':')[1];
}

// DONOR TYPE
const donorType = document.getElementById('donorType');
const donorExtra = document.getElementById('donorExtra');
donorType.oninput = ()=>{
  const v=donorType.value.toUpperCase();
  if(v==="W") {donorType.value="Walk-in"; donorExtra.style.display="none";}
  if(v==="M") {donorType.value="MBD"; donorExtra.style.display="inline-block";}
  if(v==="P") {donorType.value="Patient Directed"; donorExtra.style.display="inline-block";}
};

// BIRTH
const bd=document.getElementById('bd'), bm=document.getElementById('bm'), by=document.getElementById('by'), age=document.getElementById('age');
bd.oninput=()=>bd.value.length===2&&bm.focus();
bm.oninput=()=>bm.value.length===2&&by.focus();
by.oninput=()=>{
  if(by.value.length===2) by.value="19"+by.value;
  const bDate=new Date(by.value,bm.value-1,bd.value);
  age.value = isNaN(bDate.getFullYear())?'':new Date().getFullYear()-bDate.getFullYear();
};

// CONTACT
document.getElementById('c1').oninput=()=>document.getElementById('c2').focus();
document.getElementById('c2').oninput=()=>document.getElementById('c3').focus();

// BLOOD TYPES
document.getElementById('bloodType').oninput=()=>{
  const map={AP:"A+",AN:"A-",BP:"B+",BN:"B-",ABP:"AB+",ABN:"AB-",OP:"O+",ON:"O-"};
  if(map[document.getElementById('bloodType').value.toUpperCase()]) document.getElementById('bloodType').value=map[document.getElementById('bloodType').value.toUpperCase()];
};
document.getElementById('bagUsed').oninput=()=>document.getElementById('bagUsed').value={K:"Karmi",T:"Terumo"}[document.getElementById('bagUsed').value.toUpperCase()]||document.getElementById('bagUsed').value;
document.getElementById('bagType').oninput=()=>document.getElementById('bagType').value={S:"Single",D:"Double",T:"Triple"}[document.getElementById('bagType').value.toUpperCase()]||document.getElementById('bagType').value;
document.getElementById('amount').oninput=()=>document.getElementById('amount').value={4:"450mL",Q:"QNS",U:"UB"}[document.getElementById('amount').value.toUpperCase()]||document.getElementById('amount').value;

// TIME
['sh','sm','eh','em'].forEach(id=>{
  document.getElementById(id).oninput=()=>{
    const e=document.getElementById(id);
    if(e.value.length===2) {
      if(id==='sh'||id==='eh'){document.getElementById(id==='sh'?'sm':'em').focus();}
      if(id==='sm'||id==='em'){document.getElementById(id==='sm'?'eh':'sh').focus();}
    }
  }
});

// SAVE DONOR
function saveDonor(){
  const donor={
    date: document.getElementById('entryDate').value,
    type: donorExtra.style.display==='inline-block'?donorExtra.value:donorType.value,
    suffix: document.getElementById('suffix').value,
    surname: document.getElementById('surname').value,
    firstName: document.getElementById('firstName').value,
    middleName: document.getElementById('middleName').value,
    birthday:`${bd.value}-${bm.value}-${by.value}`,
    age: age.value,
    address: document.getElementById('address').value,
    city: document.getElementById('city').value,
    contact:`${document.getElementById('c1').value}-${document.getElementById('c2').value}-${document.getElementById('c3').value}`,
    serial: document.getElementById('serial').value || (donors.length+1),
    bloodType: document.getElementById('bloodType').value,
    times: document.getElementById('times').value,
    bagUsed: document.getElementById('bagUsed').value,
    bagType: document.getElementById('bagType').value,
    amount: document.getElementById('amount').value,
    timeStart:`${document.getElementById('sh').value}:${document.getElementById('sm').value}`,
    timeEnd:`${document.getElementById('eh').value}:${document.getElementById('em').value}`
  };
  if(editIndex!==null){donors[editIndex]=donor; localStorage.removeItem('editIndex');}
  else {
    if(!donor.serial){skippedSerials.push(donor.serial);}
    donors.push(donor);
  }
  localStorage.setItem('donors',JSON.stringify(donors));
  localStorage.setItem('skippedSerials',JSON.stringify(skippedSerials));
  alert("Donor saved successfully!");
  document.getElementById('donorForm').reset();
  document.getElementById('entryDate').value=today;
  donorExtra.style.display='none';
}
</script>

</body>
</html>
