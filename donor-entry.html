<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Donor Entry | PRC Baguio</title>

<style>
body { font-family: "Segoe UI", Arial; background:#f4f4f4; margin:0; }
header { display:flex; align-items:center; gap:15px; padding:15px 30px; border-bottom:4px solid #c62828; background:#fff;}
header img {height:55px;}
header h2 {color:#c62828; margin:0;}

.container {max-width:1200px; margin:25px auto; padding:20px;}

.section {background:#fff; border-radius:8px; padding:16px; margin-bottom:18px; border-left:6px solid #c62828;}
.row {display:flex; gap:10px; margin-bottom:10px; flex-wrap:wrap;}

input {border:1px solid #ccc; padding:7px 9px; border-radius:5px;}

.auto{flex:1;}
.small{width:110px;}
.mini{width:70px;}

.buttons{display:flex; justify-content:space-between; margin-top:20px;}

button{background:#c62828; color:white; border:none; padding:10px 18px; border-radius:6px;}
.secondary{background:#eee; color:#333;}

#donorExtra{display:none;}
</style>
</head>

<body>

<header>
  <img src="assets/logo.png">
  <h2>Philippine Red Cross â€“ Baguio City Chapter</h2>
</header>

<div class="container">
<form id="donorForm">

<div class="section">
<h3>Basic Information</h3>
<div class="row">
<input type="date" id="entryDate">
<input id="donorType" class="small" placeholder="W/M/P">
<input id="donorExtra" class="auto" placeholder="Specify">
</div>
</div>

<div class="section">
<h3>Name</h3>
<div class="row">
<input id="suffix" placeholder="Suffix" class="mini">
<input id="surname" placeholder="Surname" class="auto">
<input id="firstName" placeholder="First Name" class="auto">
<input id="middleName" placeholder="Middle Name" class="auto">
</div>
</div>

<div class="section">
<h3>Birth</h3>
<div class="row">
<input id="bd" class="mini" placeholder="DD">
<input id="bm" class="mini" placeholder="MM">
<input id="by" class="mini" placeholder="YYYY">
<input id="age" class="small" placeholder="Age" readonly>
<input id="sex" class="mini" placeholder="M/F">
</div>
</div>

<div class="section">
<h3>Contact</h3>
<div class="row">
<input id="address" class="auto" placeholder="Address">
<input id="city" class="small" placeholder="City">
</div>
<div class="row">
<input id="c1" class="mini" maxlength="4">
<input id="c2" class="mini" maxlength="3">
<input id="c3" class="mini" maxlength="4">
</div>
</div>

<div class="section">
<h3>Blood & Collection</h3>
<div class="row">
<span>PRC2600-</span>
<input id="serial" class="auto">
<input id="bloodType" class="small">
<input id="times" class="mini" placeholder="Times">
</div>

<div class="row">
<input id="bagUsed" class="small" placeholder="K/T">
<input id="bagType" class="small" placeholder="S/D/T">
<input id="amount" class="small" placeholder="Amount">
</div>

<div class="row">
<input id="sh" class="mini" placeholder="HH">
<input id="sm" class="mini" placeholder="MM">
to
<input id="eh" class="mini">
<input id="em" class="mini">
</div>
</div>

<div class="buttons">
<button type="button" class="secondary" onclick="location.href='dashboard.html'">Home</button>

<div>
<button type="button" onclick="saveDonor()">Submit</button>
<button type="button" class="secondary" onclick="location.href='donor-list.html'">Go to Donor List</button>
</div>
</div>

</form>
</div>

<script>

const today = new Date().toISOString().split("T")[0];
entryDate.value = today;

donorType.oninput=()=>{
  const v=donorType.value.toUpperCase();
  donorExtra.style.display=(v==="M"||v==="P")?"inline":"none";
  if(v==="W") donorType.value="Walk-in";
  if(v==="M") donorType.value="MBD";
  if(v==="P") donorType.value="Patient Directed";
};

by.oninput=()=>{
  age.value=new Date().getFullYear()-by.value;
};

function saveDonor(){

let donors = JSON.parse(localStorage.getItem("donors")) || [];

let data = {
date:entryDate.value,
donorType:donorType.value,
suffix:suffix.value,
surname:surname.value,
firstName:firstName.value,
middleName:middleName.value,
birthday: bm.value+"/"+bd.value+"/"+by.value,
age:age.value,
sex:sex.value,
address:address.value,
city:city.value,
contact:c1.value+"-"+c2.value+"-"+c3.value,
serial:serial.value,
bloodType:bloodType.value,
times:times.value,
bagUsed:bagUsed.value,
bagType:bagType.value,
amount:amount.value,
time:sh.value+":"+sm.value+" to "+eh.value+":"+em.value
};

let editIndex = localStorage.getItem("editIndex");

if(editIndex!==null){
 donors[editIndex]=data;
 localStorage.removeItem("editIndex");
 alert("Updated!");
}else{
 donors.push(data);
 alert("Saved!");
}

localStorage.setItem("donors",JSON.stringify(donors));

location.href="donor-list.html";
}

window.onload=()=>{
 let i=localStorage.getItem("editIndex");
 if(i!==null){
  let donors=JSON.parse(localStorage.getItem("donors"));
  let d=donors[i];

  entryDate.value=d.date;
  donorType.value=d.donorType;
  suffix.value=d.suffix;
  surname.value=d.surname;
  firstName.value=d.firstName;
  middleName.value=d.middleName;
  age.value=d.age;
  sex.value=d.sex;
  address.value=d.address;
  city.value=d.city;

  let c=d.contact.split("-");
  c1.value=c[0];
  c2.value=c[1];
  c3.value=c[2];

  serial.value=d.serial;
  bloodType.value=d.bloodType;
  times.value=d.times;
  bagUsed.value=d.bagUsed;
  bagType.value=d.bagType;
  amount.value=d.amount;
 }
};

</script>
</body>
</html>
