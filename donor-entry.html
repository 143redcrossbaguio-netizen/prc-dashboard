<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Donor Entry - PRC Baguio</title>
<style>
body { font-family: Arial, sans-serif; background:#fff; color:#b71c1c; padding:20px; }
h2 { text-align:center; }
form { max-width:900px; margin:auto; display:grid; grid-template-columns: repeat(4, 1fr); gap:10px; }
label { display:block; font-weight:bold; margin-bottom:5px; }
input, select { padding:5px; width:100%; box-sizing:border-box; }
input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
input.auto-resize { width:100%; }
button { padding:10px 20px; background:#b71c1c; color:white; border:none; cursor:pointer; border-radius:5px; }
button:hover { background:#a11212; }
.full-row { grid-column: span 4; }
.one-row { display:flex; gap:10px; }
.one-row input { flex:1; }
.nav-buttons { text-align:center; margin-top:20px; display:flex; justify-content:space-between; }
</style>
</head>
<body>

<h2>Donor Entry</h2>

<form id="donorForm">

<!-- Donor Type -->
<div class="full-row">
<label>Donor Type</label>
<select id="donorType" onchange="handleDonorType()" required>
<option value="">--Select--</option>
<option value="W">Walk-in</option>
<option value="M">MBD</option>
<option value="P">Patient Directed</option>
</select>
<input type="text" id="donorTypeExtra" placeholder="Specify" style="display:none;">
</div>

<!-- Name Fields -->
<div class="one-row full-row">
<input type="text" id="suffix" placeholder="Suffix" maxlength="4">
<input type="text" id="surname" class="auto-resize" placeholder="Surname" required>
<input type="text" id="firstname" class="auto-resize" placeholder="First Name" required>
<input type="text" id="middlename" class="auto-resize" placeholder="Middle Name">
</div>

<!-- Birthday and Age -->
<div class="one-row full-row">
<input type="number" id="bday" placeholder="DD" min="1" max="31">
<input type="number" id="bmonth" placeholder="MM" min="1" max="12">
<input type="number" id="byear" placeholder="YY/YYYY" min="1" max="9999">
<input type="number" id="age" placeholder="Age" readonly>
</div>

<!-- Address and City/Region -->
<div class="one-row full-row">
<input type="text" id="address" placeholder="Address" class="auto-resize">
<input type="text" id="city" placeholder="City/Region" maxlength="15">
</div>

<!-- Contact Number -->
<div class="one-row full-row">
<input type="text" id="contact1" maxlength="4" placeholder="XXXX">
<input type="text" id="contact2" maxlength="3" placeholder="XXX">
<input type="text" id="contact3" maxlength="4" placeholder="XXXX">
</div>

<!-- Serial Number -->
<div class="one-row full-row">
<label>Serial Number</label>
<input type="text" value="PRC2600-" readonly style="flex:2">
<input type="text" id="serial" placeholder="Enter Number" style="flex:1">
</div>

<!-- Blood Type and Number of Times Donated -->
<div class="one-row full-row">
<input type="text" id="bloodType" placeholder="Blood Type (AP, AN...)" maxlength="3">
<input type="number" id="donationCount" placeholder="Times Donated" min="1">
</div>

<!-- Blood Bag Used, Type, Amount -->
<div class="one-row full-row">
<input type="text" id="bagUsed" placeholder="Bag Used (K/T)" maxlength="1">
<input type="text" id="bagType" placeholder="Bag Type (S/D/T)" maxlength="1">
<input type="text" id="amount" placeholder="Amount (4/Q/U)" maxlength="1">
</div>

<!-- Time Started / Ended -->
<div class="one-row full-row">
<input type="number" id="timeStartHH" placeholder="Start HH" min="1" max="12" maxlength="2">
<input type="number" id="timeStartMM" placeholder="Start MM" min="1" max="60" maxlength="2">
<input type="number" id="timeEndHH" placeholder="End HH" min="1" max="12" maxlength="2">
<input type="number" id="timeEndMM" placeholder="End MM" min="1" max="60" maxlength="2">
</div>

<!-- Submit Button -->
<div class="full-row" style="text-align:right;">
<button type="button" onclick="submitDonor()">Submit</button>
</div>

</form>

<!-- Navigation Buttons -->
<div class="nav-buttons">
<button onclick="window.location.href='index.html'">Back to Homepage</button>
<button onclick="window.location.href='donor-list.html'">Go to Donor List</button>
</div>

<script>
// Donor type handling
function handleDonorType(){
    const type = document.getElementById("donorType").value;
    const extra = document.getElementById("donorTypeExtra");
    if(type === "M" || type === "P"){
        extra.style.display = "inline-block";
    } else {
        extra.style.display = "none";
        extra.value = "";
    }
}

// Auto-calc age
document.getElementById("byear").addEventListener("blur", function(){
    const d = parseInt(document.getElementById("bday").value);
    const m = parseInt(document.getElementById("bmonth").value);
    let y = parseInt(this.value);
    if(y<100) y += 1900;
    const age = new Date().getFullYear() - y;
    document.getElementById("age").value = age;
});

// Blood type auto fill
document.getElementById("bloodType").addEventListener("input", function(){
    const map = {AP:"A+", AN:"A-", BP:"B+", BN:"B-", ABP:"AB+", ABN:"AB-", OP:"O+", ON:"O-"};
    this.value = map[this.value.toUpperCase()] || this.value.toUpperCase();
});

// Serial number auto
document.getElementById("serial").addEventListener("input", function(){
    if(this.value.includes("PRC2600-")) this.value = this.value.replace("PRC2600-","");
});

// Submit donor
function submitDonor(){
    // Gather all data
    const donor = {
        type: document.getElementById("donorType").value,
        typeExtra: document.getElementById("donorTypeExtra").value,
        suffix: document.getElementById("suffix").value,
        surname: document.getElementById("surname").value,
        firstname: document.getElementById("firstname").value,
        middlename: document.getElementById("middlename").value,
        bday: document.getElementById("bday").value,
        bmonth: document.getElementById("bmonth").value,
        byear: document.getElementById("byear").value,
        age: document.getElementById("age").value,
        address: document.getElementById("address").value,
        city: document.getElementById("city").value,
        contact: document.getElementById("contact1").value + "-" + document.getElementById("contact2").value + "-" + document.getElementById("contact3").value,
        serial: "PRC2600-" + document.getElementById("serial").value,
        bloodType: document.getElementById("bloodType").value,
        donationCount: document.getElementById("donationCount").value,
        bagUsed: document.getElementById("bagUsed").value.toUpperCase() === "K" ? "KARMI" : document.getElementById("bagUsed").value.toUpperCase() === "T" ? "TERUMO" : "",
        bagType: document.getElementById("bagType").value.toUpperCase() === "S" ? "SINGLE" : document.getElementById("bagType").value.toUpperCase() === "D" ? "DOUBLE" : document.getElementById("bagType").value.toUpperCase() === "T" ? "TRIPLE" : "",
        amount: document.getElementById("amount").value.toUpperCase() === "4" ? "450 mL" : document.getElementById("amount").value.toUpperCase() === "Q" ? "QNS" : document.getElementById("amount").value.toUpperCase() === "U" ? "UB" : "",
        timeStart: document.getElementById("timeStartHH").value + ":" + document.getElementById("timeStartMM").value,
        timeEnd: document.getElementById("timeEndHH").value + ":" + document.getElementById("timeEndMM").value
    };

    // Save to localStorage array
    let donors = JSON.parse(localStorage.getItem("donors") || "[]");
    donors.push(donor);
    localStorage.setItem("donors", JSON.stringify(donors));

    alert("Donor added successfully!");
    document.getElementById("donorForm").reset();
}
</script>

</body>
</html>
