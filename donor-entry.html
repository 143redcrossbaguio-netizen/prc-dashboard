<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Donor Entry - PRC</title>
<style>
body { font-family: Arial; margin:20px; background:#fff; color:#b71c1c; }
header { display:flex; align-items:center; gap:10px; margin-bottom:20px; }
header img { height:50px; }
h2 { text-align:center; margin-bottom:20px; }
form { display:flex; flex-direction:column; gap:10px; max-width:900px; margin:auto; }
.row { display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
input, select { padding:5px; font-size:14px; }
input.text { flex:1; min-width:80px; }
input.small { width:60px; }
input.mini { width:40px; }
button { padding:10px; background:#b71c1c; color:white; border:none; cursor:pointer; border-radius:5px; }
button:hover { background:#a11212; }
#donorType { width:150px; }
.blood-type { width:60px; text-align:center; }
.age-box { width:50px; text-align:center; }
.serial-prefix { width:80px; text-align:center; background:#eee; border:none; }
</style>
</head>
<body>

<header>
<img src="assets/logo.png" alt="PRC Logo">
<h1>Donor Entry</h1>
</header>

<h2>Philippine Red Cross - Baguio City Chapter</h2>

<form id="donorForm">
<!-- Row 1: Donor Type -->
<div class="row">
<label>Donor Type:</label>
<input type="text" id="donorType" maxlength="1" placeholder="W/M/P">
<input type="text" id="donorTypeAuto" readonly class="text" placeholder="Walk-in/MBD/Patient Directed">
</div>

<!-- Row 2: Suffix + Name -->
<div class="row">
<label>Suffix:</label>
<input type="text" id="suffix" maxlength="4" class="small">
<label>Surname:</label>
<input type="text" id="surname" class="text">
<label>First Name:</label>
<input type="text" id="firstName" class="text">
<label>Middle Name:</label>
<input type="text" id="middleName" class="text">
</div>

<!-- Row 3: Birthday + Age -->
<div class="row">
<label>Birthday:</label>
<input type="text" id="bdayDay" class="mini" placeholder="DD" maxlength="2">
<input type="text" id="bdayMonth" class="mini" placeholder="MM" maxlength="2">
<input type="text" id="bdayYear" class="mini" placeholder="YY/YYYY" maxlength="4">
<label>Age:</label>
<input type="text" id="age" readonly class="age-box">
</div>

<!-- Row 4: Address + City -->
<div class="row">
<label>Address:</label>
<input type="text" id="address" class="text">
<label>City/Region:</label>
<input type="text" id="city" class="text">
</div>

<!-- Row 5: Contact Number -->
<div class="row">
<label>Contact Number:</label>
<input type="text" id="contact1" maxlength="4" class="mini"> -
<input type="text" id="contact2" maxlength="3" class="mini"> -
<input type="text" id="contact3" maxlength="4" class="mini">
</div>

<!-- Row 6: Serial Number -->
<div class="row">
<label>Serial Number:</label>
<input type="text" class="serial-prefix" value="PRC2600-" readonly>
<input type="text" id="serialNum" maxlength="10" class="text">
</div>

<!-- Row 7: Blood Type + Times Donated -->
<div class="row">
<label>Blood Type:</label>
<input type="text" id="bloodType" maxlength="3" class="blood-type">
<label>Times Donated:</label>
<input type="number" id="timesDonated" min="1" class="small" value="1">
</div>

<!-- Row 8: Blood Bag & Amount -->
<div class="row">
<label>Blood Bag Used:</label>
<input type="text" id="bagUsed" maxlength="1" class="small" placeholder="K/T">
<label>Bag Type:</label>
<input type="text" id="bagType" maxlength="1" class="small" placeholder="S/D/T/Q">
<label>Amount Collected:</label>
<input type="text" id="amount" maxlength="1" class="small" placeholder="4/Q/U">
</div>

<!-- Row 9: Time Started / Ended -->
<div class="row">
<label>Time Started:</label>
<input type="text" id="timeStartHH" maxlength="2" class="mini" placeholder="HH">
<input type="text" id="timeStartMM" maxlength="2" class="mini" placeholder="MM">
<label>Time Ended:</label>
<input type="text" id="timeEndHH" maxlength="2" class="mini" placeholder="HH">
<input type="text" id="timeEndMM" maxlength="2" class="mini" placeholder="MM">
</div>

<!-- Buttons -->
<div class="row" style="justify-content:center; margin-top:20px; gap:20px;">
<button type="button" onclick="submitDonor()">Submit</button>
<button type="button" onclick="goDonorList()">Go to Donor List</button>
<button type="button" onclick="goHome()">Back to Homepage</button>
</div>
</form>

<script>
// Ensure user is logged in
if(sessionStorage.getItem("loggedIn") !== "true"){
    window.location.href="login.html";
}

// Donor Type autofill
document.getElementById("donorType").addEventListener("input", function(){
    const val = this.value.toUpperCase();
    const auto = document.getElementById("donorTypeAuto");
    if(val === "W") auto.value = "Walk-in";
    else if(val === "M") auto.value = "MBD";
    else if(val === "P") auto.value = "Patient Directed";
    else auto.value = "";
});

// Birthday -> Age calculation
function calcAge(){
    const d = parseInt(document.getElementById("bdayDay").value);
    const m = parseInt(document.getElementById("bdayMonth").value);
    let y = document.getElementById("bdayYear").value;
    if(y.length === 2) y = "19"+y; // auto 2-digit year
    const birth = new Date(y, m-1, d);
    const today = new Date();
    let age = today.getFullYear() - birth.getFullYear();
    const mDiff = today.getMonth() - birth.getMonth();
    if(mDiff < 0 || (mDiff ===0 && today.getDate() < birth.getDate())) age--;
    if(!isNaN(age)) document.getElementById("age").value = age;
}
["bdayDay","bdayMonth","bdayYear"].forEach(id=>{
    document.getElementById(id).addEventListener("input", calcAge);
});

// Blood Type autofill
document.getElementById("bloodType").addEventListener("input", function(){
    const val = this.value.toUpperCase();
    const colorMap = {"A+":"#ADD8E6","A-":"#ADD8E6","B+":"#FFFF99","B-":"#FFFF99",
                      "AB+":"#FFC0CB","AB-":"#FFC0CB","O+":"#FFFFFF","O-":"#FFFFFF"};
    const shortcut = {"AP":"A+","AN":"A-","BP":"B+","BN":"B-","ABP":"AB+","ABN":"AB-","OP":"O+","ON":"O-"};
    if(shortcut[val]) this.value = shortcut[val];
    this.style.background = colorMap[this.value] || "white";
});

// Blood Bag, Bag Type, Amount auto-fill
document.getElementById("bagUsed").addEventListener("input", function(){
    const val = this.value.toUpperCase();
    if(val==="K") this.value="Karmi";
    else if(val==="T") this.value="Terumo";
});
document.getElementById("bagType").addEventListener("input", function(){
    const val = this.value.toUpperCase();
    const map = {"S":"Single","D":"Double","T":"Triple","Q":"Quadruple"};
    if(map[val]) this.value = map[val];
});
document.getElementById("amount").addEventListener("input", function(){
    const val = this.value.toUpperCase();
    const map = {"4":"450ml","Q":"QNS","U":"UB"};
    if(map[val]) this.value = map[val];
});

// Time auto cursor movement
["timeStartHH","timeStartMM","timeEndHH","timeEndMM"].forEach((id,index,arr)=>{
    document.getElementById(id).addEventListener("input", function(){
        if(this.value.length==2 && index<arr.length-1) arr[index+1].focus();
    });
});

// Submit donor
function submitDonor(){
    const donor = {
        type: document.getElementById("donorTypeAuto").value,
        suffix: document.getElementById("suffix").value,
        surname: document.getElementById("surname").value,
        firstName: document.getElementById("firstName").value,
        middleName: document.getElementById("middleName").value,
        birthday: `${document.getElementById("bdayDay").value}-${document.getElementById("bdayMonth").value}-${document.getElementById("bdayYear").value}`,
        age: document.getElementById("age").value,
        address: document.getElementById("address").value,
        city: document.getElementById("city").value,
        contact: document.getElementById("contact1").value + "-" + document.getElementById("contact2").value + "-" + document.getElementById("contact3").value,
        serial: "PRC2600-" + document.getElementById("serialNum").value,
        bloodType: document.getElementById("bloodType").value,
        timesDonated: document.getElementById("timesDonated").value,
        bagUsed: document.getElementById("bagUsed").value,
        bagType: document.getElementById("bagType").value,
        amount: document.getElementById("amount").value,
        timeStart: document.getElementById("timeStartHH").value+":"+document.getElementById("timeStartMM").value,
        timeEnd: document.getElementById("timeEndHH").value+":"+document.getElementById("timeEndMM").value
    };
    let donors = JSON.parse(localStorage.getItem("donors") || "[]");
    donors.push(donor);
    localStorage.setItem("donors", JSON.stringify(donors));
    alert("Donor saved!");
    document.getElementById("donorForm").reset();
    document.getElementById("donorTypeAuto").value="";
    document.getElementById("age").value="";
}

// Navigation
function goHome(){ window.location.href="index.html"; }
function goDonorList(){ window.location.href="donor-list.html"; }

</script>
</body>
</html>
